/*! angular-gantt 11-11-2014 */
use strict;

"use strict";angular.module("gantt.movable",["gantt"]).directive("ganttMovable",["ganttMouseButton","ganttMouseOffset","ganttDebounce","ganttSmartEvent","ganttMovableOptions","$window","$document","$timeout",function(a,b,c,d,e,f,g,h){return{restrict:"E",require:"^gantt",scope:{allowMoving:"=?",allowResizing:"=?",allowRowSwitching:"=?"},link:function(i,j,k,l){var m=l.gantt.api;if(m.registerEvent("tasks","move"),m.registerEvent("tasks","moveBegin"),m.registerEvent("tasks","moveEnd"),m.registerEvent("tasks","resize"),m.registerEvent("tasks","resizeBegin"),m.registerEvent("tasks","resizeEnd"),m.registerEvent("tasks","change"),i.options&&"object"==typeof i.options.movable)for(var n in i.options.movable)i[n]=i.options[n];e.initialize(i),m.directives.on.new(i,function(e,j,k){if("ganttTaskContent"===e){var l,m,n,o=5,p=3,q=15,r=5,s=angular.element(f),t=j.row.$element,u=j.row.rowsManager.gantt.body.$element,v=j.row.rowsManager.gantt.scroll.$element,w=!1;k.bind("mousedown",function(c){j.$apply(function(){var d=C(c);if(""!==d&&1===a.getButton(c)){var e=b.getOffsetForElement(u[0],c).x;E(d,e,c)}})}),k.bind("mousemove",c(function(a){var b=C(a);""===b||!j.task.isMoving&&"M"===b?k.css("cursor",""):k.css("cursor",D(b))},5));var x=function(a,b){j.task.isMoving!==!1&&(y(a,b),z(a,b))},y=function(a,c){var d=b.getOffsetForElement(u[0],c);j.task.mouseOffsetX=d.x;var e=d.x;if("M"===a){if(i.allowRowSwitching){var f=B(d.y);void 0!==f&&j.task.row.id!==f.id&&f.moveTaskToRow(j.task)}i.allowMoving&&(e-=l,"truncate"!==j.taskOutOfRange&&(0>e?e=0:e+j.task.width>=j.gantt.width&&(e=j.gantt.width-j.task.width)),j.task.moveTo(e),j.row.rowsManager.gantt.api.tasks.raise.move(j.task))}else"E"===a?("truncate"!==j.taskOutOfRange&&(e<j.task.left?e=j.task.left:e>j.gantt.width&&(e=j.gantt.width)),j.task.setTo(e),j.row.rowsManager.gantt.api.tasks.raise.resize(j.task)):("truncate"!==j.taskOutOfRange&&(e>j.task.left+j.task.width?e=j.task.left+j.task.width:0>e&&(e=0)),j.task.setFrom(e),j.row.rowsManager.gantt.api.tasks.raise.resize(j.task));w=!0},z=function(a,c){var d=b.getOffsetForElement(u[0],c),e=v[0].scrollLeft,f=!1;if(d.x<m)d.x<=e+r&&(d.x-=q,f=!0,j.row.rowsManager.gantt.api.scroll.left(q));else{var g=v[0].offsetWidth,i=e+g;d.x>=i-r&&(d.x+=q,f=!0,j.row.rowsManager.gantt.api.scroll.right(q))}f&&(n=h(function(){x(a,c)},100,!0))},A=function(){void 0!==n&&(h.cancel(n),n=void 0)},B=function(a){if(a>=t[0].offsetTop&&a<=t[0].offsetTop+t[0].offsetHeight)return j.task.row;var b=[];angular.forEach(j.task.row.rowsManager.rows,function(a){a.hidden||b.push(a)});var c=u[0].offsetHeight/b.length,d=Math.floor(a/c);return b[d]},C=function(a){var c=b.getOffset(a).x,d=0;return i.allowResizing&&(d=k[0].offsetWidth<10?p:o),i.allowResizing&&c>k[0].offsetWidth-d?"E":i.allowResizing&&d>c?"W":(i.allowMoving||i.allowRowSwitching)&&c>=d&&c<=k[0].offsetWidth-d?"M":""},D=function(a){switch(a){case"E":return"e-resize";case"W":return"w-resize";case"M":return"move"}},E=function(a,b){j.task.isMoving||("M"===a?j.row.rowsManager.gantt.api.tasks.raise.moveBegin(j.task):j.row.rowsManager.gantt.api.tasks.raise.resizeBegin(j.task)),w=!1,j.task.moveMode=a,j.task.isMoving=!0,m=b,l=b-j.task.modelLeft;var e=c(function(b){j.task.isMoving&&(A(),x(a,b))},5);d(j,s,"mousemove",e).bind(),d(j,s,"mouseup",function(a){j.$apply(function(){s.unbind("mousemove",e),F(a)})}).bindOnce(),k.css("cursor",D(a)),angular.element(g[0].body).css({"-moz-user-select":"-moz-none","-webkit-user-select":"none","-ms-user-select":"none","user-select":"none",cursor:D(a)})},F=function(){j.task.isMoving=!1,A(),k.css("cursor",""),angular.element(g[0].body).css({"-moz-user-select":"","-webkit-user-select":"","-ms-user-select":"","user-select":"",cursor:""}),"M"===j.task.moveMode?j.row.rowsManager.gantt.api.tasks.raise.moveEnd(j.task):j.row.rowsManager.gantt.api.tasks.raise.resizeEnd(j.task),j.task.moveMode=void 0,w===!0&&(w=!1,j.task.row.sortTasks(),j.row.rowsManager.gantt.api.tasks.raise.change(j.task))};j.task.isCreating?(delete j.task.isCreating,E("E",j.task.mouseOffsetX)):j.task.isMoving&&E("M",j.task.mouseOffsetX)}})}}}]),angular.module("gantt.movable").factory("ganttMovableOptions",[function(){return{initialize:function(a){return a.allowMoving=void 0!==a.allowMoving?!!a.allowMoving:!0,a.allowResizing=void 0!==a.allowResizing?!!a.allowResizing:!0,a.allowRowSwitching=void 0!==a.allowRowSwitching?!!a.allowRowSwitching:!0,a}}}]);
//# sourceMappingURL=angular-gantt-movable.min.js.map